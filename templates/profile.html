{% extends "base.html" %}

{% block title %}{{mensch.__str__()}} — Das Gefolge{% endblock %}

{% block page_content %}
    {% if mensch.data['nick'].value() is none %}
        <h1>{{mensch.data['username']}}<span class="muted">#{{mensch.discrim}}</span></h1>
    {% else %}
        <h1>{{mensch.data['nick']}}</h1>
        <h2>{{mensch.data['username']}}<span class="muted">#{{mensch.discrim}}</span></h1>
    {% endif %}
    <p>Profil für Discord snowflake {{mensch.snowflake}}. (<a href="https://discordapp.com/users/{{mensch.snowflake}}/">Discord-Profil</a>)</p>
    {% if g.user.is_admin or g.user == mensch %}
        <h1>API</h1>
        <p>Mit deinem API key kannst du die <a href="{{url_for('api_index')}}">API</a> auch ohne Anmeldung über Discord verwenden. Falls du nach Anmeldedaten gefragt wirst, verwende <code>api</code> als Benutzername und deinen API key als Passwort.</p>
        <p>Dein API key: <code>{{mensch.api_key}}</code></p>
        <p>Falls dein API key in falsche Hände gerät, kannst du jederzeit einen <a class="btn btn-primary" href="{{(g.view_node / 'reset-key').url}}">neuen API key generieren</a>. Du musst dich dann überall, wo du dich mit dem alten API key angemeldet hast, mit dem neuen anmelden.</p>
        <h1>Guthaben</h1>
        <p>Du kannst dein Guthaben per Überweisung an {{g.admin}} aufladen. Mit diesem Guthaben kannst du dich dann z.B. für <a href="{{url_for('events_index')}}">events</a> anmelden.</p>
        <p>
            Aktuelles Guthaben: {{mensch.balance}}.
            {% if mensch.balance.value > 0 %}
                Wenn du dein Guthaben ausgezahlt haben möchtest, kontaktiere bitte {{g.admin}}.
            {% elif mensch.balance.value < 0 %}
                Zahle die Schulden bitte möglichst bald zurück.
            {% endif %}
        </p>
        {% if 'konto' in g.admin.userdata %}
            <p>Kontodaten:</p>
            <p>
                {{g.admin.userdata['konto']['name']}}<br />
                IBAN: {{g.admin.userdata['konto']['iban']}}<br />
                BIC: {{g.admin.userdata['konto']['bic']}}<br />
                Verwendungszweck: gefolge.org {{mensch.snowflake}}
            </p>
        {% endif %}
        {% if 'payPal' in g.admin.userdata %}
            <p>{{g.admin}} über PayPal Geld senden: <a href="https://www.paypal.me/{{g.admin.userdata['payPal']}}">paypal.me/{{g.admin.userdata['payPal']}}</a>.</p>
        {% endif %}
        <h2>Transaktionen</h2>
        <ul>
            {% for transaction in mensch.transactions | reverse %}
                <li>{{transaction.time | dmy_hms}}: {{transaction}}, {{transaction.amount}}{% if transaction.details is not none %}, Details:<br />{{transaction.details}}{% endif %}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock %}
